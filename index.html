<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>A Trip to the Moon</title>

    <!-- Favicon (place favicon.ico in /public) -->
    <link rel="icon" href="/favicon.ico" />

    <!-- Fonts + Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css?v=4" />
  </head>

  <body>
    <!-- Retro Start Overlay -->
    <div id="start-overlay">
      <div id="start-inner">
        <h1 id="start-title">Farjaux Presents</h1>
        <div id="start-sub">A Trip to the Moon</div>
        <p id="start-tip">Press <strong>Enter</strong> or click to start</p>
        <div id="insert-coin" class="insert-coin" role="button" tabindex="0">
          INSERT COIN
        </div>
      </div>
    </div>

    <main class="wrap">
      <div>
        <div class="brand">Farjaux presents</div>
        <h1 class="title">A Trip to the Moon</h1>
      </div>

      <div class="divider"></div>

      <section class="card" id="about">
        <h2>About</h2>
        <p>
          A browser-based, pixel-perfect homage to Georges MÃ©liÃ¨sâ€™ 1902 film.
        </p>
        <p>
          Guide <strong>Farjaux</strong> through iconic scenes â€” rocket launch,
          lunar wonders, and the triumphant return.
        </p>
        <p class="muted">Best experienced on desktop with sound on ğŸ§</p>
        <button
          class="btn"
          onclick="document.getElementById('game').scrollIntoView({ behavior: 'smooth' })"
        >
          Play Now
        </button>
      </section>

      <section class="card" id="controls">
        <h2>Controls</h2>
        <p>â† â†’ Move â€¢ â†‘ Jump â€¢ SPACE Action â€¢ Esc Pause</p>
        <p class="muted">Controller support coming soon.</p>
      </section>

      <section class="card crt" id="game"></section>

      <section class="card" id="extras">
        <h2>Extras</h2>
        <ul style="list-style: none; padding: 0; margin: 0">
          <li>ğŸï¸ Inspired by <em>Le Voyage dans la Lune</em> (1902)</li>
          <li>ğŸ•¹ï¸ Built with Phaser + Vite</li>
          <li>ğŸ’¾ Open-source soon on GitHub</li>
        </ul>
      </section>

      <footer>Â© <span id="year"></span> Farjaux â€¢ All rights reserved</footer>
    </main>

    <!-- Start logic + year -->
    <script>
      document.getElementById("year").textContent = new Date().getFullYear();

      // Load Google font deterministically before starting Phaser/game text
      async function loadFonts() {
        // If the Font Loading API is missing, just continue.
        if (!("fonts" in document)) return;

        // Wait for the specific family + global readiness; also provide a timeout fallback.
        const loadPressStart = document.fonts.load('24px "Press Start 2P"');
        const ready = document.fonts.ready;

        // Safety timeout so we don't get stuck on slow networks
        const timeout = new Promise((resolve) => setTimeout(resolve, 1500));

        try {
          await Promise.race([Promise.all([loadPressStart, ready]), timeout]);
        } catch (_) {
          // Non-fatal; we still proceed
        }
      }

      const start = async () => {
        if (document.body.classList.contains("started")) return;
        document.body.classList.add("started");

        // âœ… Ensure font is available before any Phaser/flash text draws
        await loadFonts();

        // Tell main.js to boot the game now.
        window.dispatchEvent(new Event("farjaux:start"));
      };

      // INSERT COIN click / keyboard activation
      const insert = document.getElementById("insert-coin");
      insert.addEventListener("click", start);
      insert.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          start();
        }
      });

      // Enter or Space anywhere
      window.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") start();
      });

      // Clicking empty overlay background also starts
      document
        .getElementById("start-overlay")
        .addEventListener("click", (e) => {
          if (e.target.id === "start-overlay") start();
        });
    </script>

    <!-- Vite injects your JS bundle -->
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
